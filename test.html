<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Water Tank Level</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Water Tank Level</h1>

    <div class="tank">
        <div class="water default" id="water"></div>
        <div class="level-text" id="levelText">Loading...</div>
    </div>

    <script>
        const channelID = "3026172"; // Your ThingSpeak Channel ID
        const readAPIKey = "AHHPO1T2TZDGZ2G8"; // Your ThingSpeak Read API Key

        function updateTank(level) {
            const waterDiv = document.getElementById("water");
            const levelText = document.getElementById("levelText");

            // Set height of water
            waterDiv.style.height = `${level}%`;
            levelText.textContent = `${level}%`;

            // Remove all color classes
            waterDiv.className = "water";

            // Set color based on level
            if (level >= 100) {
                waterDiv.classList.add("green");
            } else if (level >= 75) {
                waterDiv.classList.add("blue");
            } else if (level >= 50) {
                waterDiv.classList.add("yellow");
            } else if (level >= 25) {
                waterDiv.classList.add("red");
            } else {
                waterDiv.classList.add("red", "flash");
            }
        }

        function fetchLevel() {
            const url = `https://api.thingspeak.com/channels/${channelID}/fields/1/last.json?api_key=${readAPIKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const level = parseFloat(data.field1) || 0;
                    updateTank(level);
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                });
        }

        // Initial load
        fetchLevel();
        // Update every 20 seconds
        setInterval(fetchLevel, 20000);
    </script>
</body>
</html>
